@model List<DiscountProduct>

@{
    ViewData["Title"] = "Home Page";
}

@await Html.PartialAsync("_navbar")

@await Html.PartialAsync("_searchbar")

@if (Model != null && Model.Any())
{
    <div class="row g-4">
        @foreach (var product in Model)
        {
            var discountRate = product.HighPrice > 0 ? (100 - (product.LowPrice * 100 / product.HighPrice)) : 0;
            var discountRateInt = (int)discountRate;

            <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                <div class="card border-0 shadow-lg p-2 position-relative rounded-4 product-card">

                    <!-- İndirim Etiketi (Eğer indirim varsa göster) -->
                    @if (discountRate > 0)
                    {
                        <div class="position-absolute top-0 start-0 bg-danger text-white fw-bold px-3 py-1 rounded-bottom">
                            %@(discountRateInt) İndirim
                        </div>
                    }

                    <!-- Ürün Resmi -->
                    <img src="@Url.Content(product.ImageUrl)" class="card-img-top rounded-3"
                         style="width: 100%; height: 200px; object-fit: contain;">

                    <div class="card-body text-center">
                        <h6 class="text-uppercase text-muted mb-1">@product.ProductName</h6>
                        <p class="fw-bold text-dark mb-2">
                            @(product.ProductDescription.Length > 100
                                ? product.ProductDescription.Substring(0, 100) + "..."
                                : product.ProductDescription)
                        </p>

                        <!-- Fiyat Bilgisi -->
                        <p class="mb-3">
                            <!-- Eğer indirim varsa, highPrice üstü çizili gri renkte gösterilsin -->
                            @if (product.HighPrice > product.LowPrice)
                            {
                                <span class="text-muted text-decoration-line-through me-2">@product.HighPrice TL</span>
                            }
                            <span class="text-danger fw-bold fs-4">@product.LowPrice TL</span>
                        </p>

                        <!-- Sepete Ekle Butonu -->
                        <button type="button" class="btn btn-danger w-100 fw-bold py-2 rounded-3 shadow-sm add-to-cart-btn"
                                onclick="addToCart('@product.ProductName', '@product.LowPrice', '@Url.Content(product.ImageUrl)')">
                            Sepete Ekle
                            <i class="bi bi-cart-plus ms-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
}

else
{
    <div class="text-center mt-5">
        <i class="bi bi-box-seam text-muted" style="font-size: 3rem;"></i>
        <p class="text-muted mt-2">Henüz ürün eklenmedi. Yeni fırsatlar için takipte kalın!</p>
    </div>
}

@await Html.PartialAsync("_footer")

<style>
    .product-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .product-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

    .add-to-cart-btn {
        background: linear-gradient(to right, #ff416c, #ff4b2b);
        border: none;
    }

        .add-to-cart-btn:hover {
            opacity: 0.8;
        }
</style>
